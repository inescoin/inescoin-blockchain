#!/usr/bin/env php
<?php

// Copyright 2019 The Inescoin developers.
// - Mounir R'Quiba
// Licensed under the GNU Affero General Public License, version 3.

use Inescoin\RPC\RpcServer;
use Inescoin\MinerPool;
use Inescoin\EC\AddressValidator;

require __DIR__.'/../../vendor/autoload.php';


$params = getopt('', [
	'rpc-ip::',
	'rpc-port::',
	'wallet-address::',
]);


$rpcIp 		= $params['rpc-ip'] ?? '127.0.0.1' ;
$rpcPort 	= $params['rpc-port'] ?? 8087;
$walletAddress 	= $params['wallet-address'] ?? '';


if (empty($walletAddress)) {
	throw new Exception("Option '--wallet-address=XXXXXXXXXXXXXXXXXXXXXXXXX not found", 1);
}

$valideAddress = AddressValidator::isValid($walletAddress);

if (in_array($valideAddress, AddressValidator::INVALID)) {
	throw new Exception("Invalid address format => " . $walletAddress, 1);
}

(new MinerPool($rpcIp, $rpcPort, $walletAddress))->start();
